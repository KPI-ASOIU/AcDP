//= require ./datetimepicker

<% url = AcDP::Application.routes.url_helpers %>

$(document).ready(function() {
    $('#docs').tablesort();

    $('#addFolder').on('click', function(e) {
        e.preventDefault();
        $('#addFolderForm').modal('show')
    });

    $('#addDocument').on('click', function(e) {
        e.preventDefault();
        $('#addDocForm').modal('show')
    });

    $('[data-id="downloadFile"]').on('click', function(e) {
        e.stopPropagation();
    });

    $("#newDocFile").change(function (){
        var fileName = $(this).val(),
            docsAddTitle = $("#newDocTitle");

        if(docsAddTitle.val() == '') {
          $("#newDocTitle").val(fileName.split('\\').pop());
        }
    });

    var docInfo = $('#docInfo').sidebar('setting', 'transition', 'overlay'),
        docSearchForm = $('#searchDocsForm');

    $(document).on("click", '#docs tr[data-id="file"]', function(e) {
        var doc_id = $(this).find("[id*='doc-title-']").attr('id').match(/[0-9]+/)[0]
        $.ajax({
            type: "GET",
            url: "<%= url.documents_sidebar_info_path %>.js",
            data: {
                id: doc_id
            },
            dataType: "html",
            success: function(data) {
                docInfo.html(data);
                docInfo.sidebar("show");
                $('#forRoles,#personal').dropdown();
                $('#docTypes').dropdown({
                    allowAdditions: true,
                    message: {
                        addResult: 'Додати тип <b>{term}</b>'
                    }
                });
            },
            error: function() {
                alert("ERROR!");
            }
        })
    });

    docSearchForm.on('submit', function() {
        var $input = $(this).find('.search.input');
        $input.addClass('loading');
        $input.removeClass('error');
    });

    docSearchForm.on('ajax:success', function() {
        $(this).find('.search.input').removeClass('loading'); 
    });

    docSearchForm.on('ajax:error', function() {
        var $input = $(this).find('.search.input');
        $input.removeClass('loading'); 
        $input.addClass('error');
    })
});

// Change the selector if needed
var $table = $('table.scrollable'),
    $bodyCells = $table.find('tbody tr:first').children(),
    colWidth;