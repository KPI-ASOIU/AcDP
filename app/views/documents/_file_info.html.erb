<% if current_user == doc.owner %>
  <div class="ui basic segment">
    <%= link_to doc.file_info ? doc.file_info.file.url(:original, false) : '', target: :blank, class: 'ui blue exact right corner label' do %>
      <i class="download icon"></i>
    <% end %>
    <div class="ui center aligned basic segment">
      <i class="huge <%= doc_format_icon(doc) %>"></i>
    </div>
    <%= form_for(doc, :html => {class: "ui form", method: :patch }) do |f| %>
      <div class="field">
        <%= f.label :title, t('documents.title') %>
        <%= f.text_field :title, :placeholder => t('documents.title') + '...' %>
      </div>
      <div class="field">
        <%= f.label :for_roles, t('documents.for_roles') %>
        <%= f.select :for_roles, options_for_select(User::ROLES.map { |r| [t("roles.#{r}"), r] }, User.int_to_roles(doc.for_roles)), {include_hidden: false}, {id: "forRoles", class: "ui fluid search dropdown", multiple: true} %>
      </div>
      <div class="field">
        <%= label_tag :personal_shared, t('documents.personal') %>
        <%= select_tag :personal_shared, options_for_select(User.all.map { |u| [u.full_name, u.id] }, doc.shared_to.pluck(:id)), {id: "personal", class: "ui fluid search dropdown", multiple: true} %>
      </div>
      <div class="field">
        <%= label_tag :document_types, t('documents.type') %>
        <%= select_tag :document_types, options_for_select(DocumentType.all.map { |dt| [dt.title, dt.title] }, doc.document_types.pluck(:title)), {id: 'docTypes', class: "ui fluid search dropdown", multiple: true} %>
      </div>
      <div class="field">
        <%= f.label :description, t('documents.description') %>
        <%= f.text_area :description %>
      </div>
      <div class="ui buttons">
        <%= f.submit t('helpers.submit.update'), class: 'ui green button' %>
        <div class="or" data-text="чи"></div>
        <%= link_to t('documents.delete'), document_delete_path(doc.id), method: :delete, class: 'ui red button' %>
      </div>
    <% end %>
  </div>
<% else %>
  <div class="ui basic segment">
    <%= link_to doc.file_info ? doc.file_info.file.url(:original, false) : '', target: :blank, class: 'ui blue exact right corner label' do %>
      <i class="download icon"></i>
    <% end %>
    <div class="ui center aligned basic segment">
      <i class="huge <%= doc_format_icon(doc) %>"></i>
      <div class="ui header">
        <%= doc.title %>
      </div>
    </div>
  </div>
  <div class="ui basic segment container">
    <table class="ui fluid collapsing celled table">
      <tr>
        <td>
          <h4 class="ui header">
            <div class="content">
              <%= t('documents.for_roles') %>
            </div>
          </div>
        </h4></td>
        <td style="width: 99%;">
          <% roles = User.int_to_roles(doc.for_roles) %>
          <%= User::ROLES.map { |r| [r, t("roles.#{r}")] }
                .select { |r| roles.include? r.first }
                .map {|r| r.last }
                .join(", ").presence or t('roles.all') %>
        </td>
      </tr>
      <tr>
        <td>
          <h4 class="ui header">
            <div class="content">
              <%= t('documents.type') %>
            </div>
          </div>
        </h4></td>
        <td>
          <%= DocumentType.all.map { |dt| [dt, dt.title] }
                .select { |dt| doc.document_types.include? dt.first }
                .map {|dt| dt.last }
                .join(", ").presence or t('documents.no_type') %>
        </td>
      </tr>
      <tr>
        <td>
          <h4 class="ui header">
            <div class="content">
              <%= t('documents.description') %>
            </div>
          </div>
        </h4></td>
        <td>
          <%= doc.description.presence or t('documents.no_description') %>
        </td>
      </tr>
    </table>
  </div>
<% end %>
